<html xmlns:wb="http://open.weibo.com/wb">
<head>
    <title>个人资料设置_活动家</title>
    <meta name="keywords" content="个人资料，活动家" />
    <meta name="description" content="在活动家设置个人资料。找会议，上活动家！" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/usercenter/css/index.css"/>
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <link href="http://huodongjia-yun.b0.upaiyun.com/static/css/non-responsive.css?t=20151030.css" rel="stylesheet">
    <![endif]-->
</head>
<body id="settings">
<h3>个人资料设置</h3>
<div class="container notUpdate">
    <table>
        <tr>
            <td width="110px"><label for="username" class="control-label">姓名</label></td>
            <td width="330px">{{curuser.name}}</td>
            <td> </td>
        </tr>
        <tr>
            <td width="110px"><label class="control-label">性别</label></td>
            <td>
                {% if curuser.sex == 1 %}
                男
                {% else %}
                女
                {% endif %}
            </td>
            <td> </td>
        </tr>
        <tr>
            <td width="110px"><label for="industry" class="control-label">所属行业</label></td>
            <td>
                {% if curuser.industry == '2' %}
                IT互联网
                {% else %}{% if curuser.industry == '6' %}
                金融财经
                {% else %}{% if curuser.industry == '3' %}
                能源化工
                {% else %}{% if curuser.industry == '4' %}
                医疗行业
                {% else %}{% if curuser.industry == '9' %}
                农业林业
                {% else %}{% if curuser.industry == '96' %}
                其他
                {% endif %}
                {% endif %}
                {% endif %}
                {% endif %}
                {% endif %}
                {% endif %}
            </td>
            <td></td>
        </tr>
        <tr>
            <td width="110px"><label for="telephone" class="control-label">手机号码</label></td>
            <td>
                {% if curuser.telephone %}
                {{curuser.telephone}}
                {% endif %}
            </td>
            <td> </td>
        </tr>
        <tr>
            <td width="110px"><label for="email" class="control-label">邮箱</label></td>
            <td>
                {% if curuser.email %}
                {{curuser.email}}
                {% endif %}
            </td>
            <td> </td>
        </tr>
        <tr>
            <td> </td>
            <td><input type="button" class="update" value="修改资料"/></td>
        </tr>
    </table>
</div>
<div class="container notUpForm" style="display: none;">
    <form class="form-horizontal" data-status="{{curuser.status}}" action="/usercenter/userprofile/" method="post">{% csrf_token %}
        <table>
            <tr>
                <td width="110px"><label for="username" class="control-label">姓名</label></td>
                <td><input type="text" class="form-control" id="username" name="username" value='{{curuser.name}}'></td>
                <td> </td>
            </tr>
            <tr>
                <td width="110px"><label class="control-label">性别</label></td>
                <td>
                    <label class="radio-inline">
                        <input type="radio" name="usersex" id="inlineRadio1" value="1" {% if curuser.sex == 1 %}checked="checked" {% endif%}> 男
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="usersex" id="inlineRadio2" value="0" {% if curuser.sex == 0 %}checked="checked" {% endif%}> 女
                    </label>
                </td>
                <td> </td>
            </tr>
            <tr>
                <td width="110px"><label for="industry" class="control-label">所属行业</label></td>
                <td>
                    <select class="form-control" id="industry" value="{{curuser.industry}}" name="industry">
                        <option name="industry" value='2'>IT互联网</option>
                        <option name="industry" value='6'>金融财经</option>
                        <option name="industry" value='3'>能源化工</option>
                        <option name="industry" value='4'>医疗行业</option>
                        <!--<option name="industry" value='10'>学术研究</option>-->
                        <option name="industry" value='9'>农林牧渔</option>
                        <option name="industry" value='118'>教育培训</option>
                        <option name="industry" value='120'>加工制造</option>
                        <option name="industry" value='122'>地产建筑</option>
                        <option name="industry" value='124'>文化传媒</option>
                        <option name="industry" value='126'>服务行业</option>
                        <option name="industry" value='128'>交通物流</option>
                        <option name="industry" value='96'>其他行业</option>
                    </select>
                </td>
                <td></td>
            </tr>
            <tr>
                <td width="110px"><label for="telephone" class="control-label">手机号码</label></td>
                <td><input type="text" class="form-control" id="telephone" name="telephone" {% if curuser.telephone%} value='{{curuser.telephone}}' {%endif%} required></td>
                <td> </td>
            </tr>
            <tr>
                <td width="110px"><label for="authcode" class="control-label">验证码</label></td>
                <td><input type="text" class="form-control" id="authcode" name="authcode"><input type="button" id="authcodebtn" value="获取验证码"/></td>
                <td></td>
            </tr>
            <tr>
                <td width="110px"><label for="email" class="control-label">邮箱</label></td>
                <td><input type="text" class="form-control" id="email" name="email" {% if curuser.email %} value='{{curuser.email}}'{% endif %} required></td>
                <td> </td>
            </tr>
            <tr>
                <td> </td>
                <td><input type="submit" value="确认修改"/></td>
            </tr>
        </table>
    </form>
</div>
<script src="http://cdn.bootcss.com/jquery/1.7/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js"></script>
<script>
    var wait=30;
    function time(t) {
        if (wait == 0) {
            t.removeAttribute("disabled");
            t.value="获取验证码";
            wait =30;
        }
        else {
            t.setAttribute("disabled", true);
            t.value="重新发送(" + wait + ")";
            wait--;
            setTimeout(function(){time(t)},1000);
        }
    }
    $(document).ready(function(){
        $("#authcodebtn").click( function () {
            var telephone =$("#telephone").val()
            if(telephone.match(/0?(13|14|15|18|17)[0-9]{9}/)){
                time(this);
            }else{

            }

            var date = new Date().getTime();
            $.post('/usercenter/getauthcode/',{'telephone':telephone,times:date}, function (data) {})
        });
    });
    $("#settings table tr").each(function () {
        $(this).find("td:eq(0)").css({paddingRight:"30px",textAlign:"right"})
    })
    $("#settings .update").on('click', function () {
                $("#settings .notUpForm").slideDown()
                $("#settings .notUpdate").slideUp()
            }
    )
    $(".form-horizontal").submit(function () {
        var $this = $(this);
        $.ajax({
            url:"/usercenter/userprofile/",
            type:"post",
            data:$(".form-horizontal").serialize(),
            success: function (data) {

                if(data.indexOf("code")==-1){
                    top.frames.swal(data)
                }else{
                    var s=eval("("+data+")")
                    if(s.code== 1){
                        if($this.attr("data-status") == 0){
                            var option = {
                                images:"success",
                                title:"更新成功",
                                tips:"恭喜你获得<span style='color: #e65052;'>20</span>积分。<a target='myframe' href='/usercenter/exchange/'>去看看</a>",
                                fromView:false,
                            }
                            top.frames.userPopup(option)
                            history.go(0)
                        }else{
                            top.frames.swal("更新成功")
                            history.go(0)
                        }
                    }else{
                        top.frames.swal("修改失败")
                    }
                }
            }
        })
        return false
    })
</script>
</body>
</html>
